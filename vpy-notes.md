# DRA - Ardupilot and qgc
## Todo
- Connect K64 to PX4
- Send DRA val form K64
- Read DRA val in Ardupilot
- Create a new mavlink message
- Add this mavlink message in Ardupilot and send it
- Add support for this Mavlink message in qgc and show it

## To generate Mavlink headers
python /home/valentinpy/DRA/mavlink-generator/mavgenerate.py
- Give it the XML file and the destination path and click on OK
- it generates headers,... :)

## To compile
- Ardupilot:
    - cd /home/valentinpy/DRA/ardupilot
    - ./waf configure --board px4-v2
    - ./waf copter
    - ./waf --targets bin/arducopter --upload and connect the board when asked to

- QGC: 
    - launch QTCreator and build / run project from there


## First app ardupilot
https://dev.px4.io/en/apps/hello_sky.html


## Done:
### Mavlink message definition
- Added messages 239 and 240 in ../modules/mavlink/message_definitions/v1.0/ardupilotmega.xml
- use mavgenerate.py to update headers, but it's automatically called when compiling with waf

### Ardupilot: read uart and send mavlink
- Added usercode loops in APM_Config.h
- Added usercode in UserCode.cpp and UserVariables.h
    - read from uart5/uartE at 57600 bauds
    - write on uart5/uartE at 57600 bauds
    - send mavlink message by using mavlink_msg_vpy_test_send(...) (this function is generated by mavgenerate and is in the build folder)

### CGS: support new Mavlink message
- See: http://ardupilot.org/dev/docs/code-overview-adding-a-new-mavlink-message.html
    - uninstall pymavlink: sudo pip uninstall pymavlink
    - module written in /usr/local/lib/python2.7/dist-packages/MAVProxy/modules/
        - todo: add in mavproxy ?
    


# TODO
- uncomment the power_status function in ArduCopter/GCS_Mavlink.cpp
- comment the power status send function in userCode.cpp


cd ~/DRA/ardupilot/modules/mavlink/pymavlink
python setup.py install --user

cd /home/valentinpy/DRA/MAVProxy
vim MAVProxy/modules/mavproxy_VPY.py 
python setup.py install --user    
mavproxy.py --cmd="module load VPY"